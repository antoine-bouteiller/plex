(cors) {
	@cors_preflight{args.0} method OPTIONS
	@cors{args.0} header Origin {args.0}

	header @cors{args.0} {
		Access-Control-Allow-Origin "{args.0}"
		Access-Control-Expose-Headers *
		Access-Control-Allow-Credentials "true"
	}

	handle @cors_preflight{args.0} {
		header {
			Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE"
			Access-Control-Allow-Headers *
			Access-Control-Max-Age "3600"
		}
		respond "" 204
	}
}

(auth) {
	import cors https://dashboard.{$DOMAIN}
	forward_auth authelia:9091 {
		uri /api/authz/forward-auth
		copy_headers Remote-User Remote-Groups Remote-Email Remote-Name
		header_down -Authorization
	}
}

{$DOMAIN} {
	reverse_proxy jellyseerr:5055
}

sonarr.{$DOMAIN} {
	import auth
	reverse_proxy sonarr:8989 {
		header_down -Access-Control-Allow-Origin
	}
}

radarr.{$DOMAIN} {
	import auth
	reverse_proxy radarr:7878 {
		header_down -Access-Control-Allow-Origin
	}
}

prowlarr.{$DOMAIN} {
	import auth
	reverse_proxy prowlarr:9696 {
		header_down -Access-Control-Allow-Origin
	}
}

qbittorrent.{$DOMAIN} {
	import auth

	reverse_proxy qbittorrent:8080
}

dashboard.{$DOMAIN} {
	import auth

	reverse_proxy homepage:3000
}

# fancontroller.{$DOMAIN} {
# 	import auth

# 	reverse_proxy host.docker.internal:11987
# }

plex.{$DOMAIN} {
	reverse_proxy host.docker.internal:32400
}

auth.{$DOMAIN} {
	reverse_proxy authelia:9091
}

bazarr.{$DOMAIN} {
	import auth

	reverse_proxy bazarr:6767
}

# grafana.{$DOMAIN} {
# 	import auth

# 	reverse_proxy grafana:3000
# }
